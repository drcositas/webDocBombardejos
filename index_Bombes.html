<!DOCTYPE html>
<html>
<head>
  <title>Mapa 1</title>
  <meta charset="utf-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" />
  <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet" type="text/css"/>
  <style type="text/css">

    #map{
       width: 100%;
       height: 100%;
        background:white;
    }
      
      body{
        margin:0px;   
          height:100%;
          width:100%
      }
      
      html{
          margin:0px;   
          height:100%;
          width:100%
          
      }

      .leaflet-control-layers{
          top: 10px;
          border-radius:0px;
          width:60px;
          bottom:35px;     
      }
      
      .leaflet-control-zoom leaflet-bar leaflet-control{
          border-radius:0px;
      }

      #down{
          position:absolute;
          bottom:10px;
          left:10px;
          background:white;
          box-shadow: 0px 0px 4px gray;
          /*border:1px gray solid;*/
          margin:white;
          width:376px;
          font-family: "sans-serif", "arial";
          font-size:12px;
          padding:5px;
      }
      #down a{
          text-decoration:none;
          color:black;
          display:block;
          
      }

      .rc{
          width:13px;
          margin-right:5px;    
      }

  </style>


  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
  <script src="jquery.color.min.js"></script>
  <script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script>
  <script src="http://popcornjs.org/code/dist/popcorn-complete.min.js"></script>
  <script src="aishek-jquery-animateNumber-5f436e7/bouncemarker.js" type="text/javascript"></script>
  <script src="refugis.js" type="text/javascript"></script>
  <script src="bombes_tmp.js" type="text/javascript"></script>
  <script>

    $(document).ready(
      function () {

      window.map = L.map('map', {
          attributionControl:false,
          zoomControl: false
      	}).setView([41.386837, 2.169708], 14);//Per possar la orientacio inicial


      // Disable drag and zoom handlers.
      map.dragging.disable();
      map.touchZoom.disable();
      map.doubleClickZoom.disable();
      map.scrollWheelZoom.disable();
      map.keyboard.disable();

      // Disable tap handler, if present.
      if (map.tap) map.tap.disable();
      var Esri_WorldImagery = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
      });

      var martorell =L.tileLayer('http://www.300000kms.net/_btv/martorell/{z}/{x}/{y}.png', {
        maxZoom: 18,
        minZoom:12,
        tms: false,
        attribution: '<a target="_blank" href="http://www.300000kms.net">300.000Km/s</a>'
      });//carrega de papa
      var OpenStreetMap_BlackAndWhite = L.tileLayer('http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png', {
        maxZoom: 18,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
      });
      var baseMaps = {
        "Antic": martorell,
        "Actual Mapa": OpenStreetMap_BlackAndWhite,
        "Actual Satel·lit": Esri_WorldImagery
      };
      
      L.control.scale().addTo(map);
      

    //A���adimos las capas de OpenStreetMap y Google al mapa

      map.addLayer(martorell, Esri_WorldImagery);
       //Crar icona a partir d'una foto
      window.bombIcon = L.icon({
        iconUrl: 'bomb.png',
        iconSize: [20, 30],
        iconAnchor: [20, 30],
        popupAnchor: [0, -28]
      });
      window.expIcon = L.icon({
        iconUrl: 'explosion.png',
        iconSize: [20, 30],
        iconAnchor: [20, 30],
        popupAnchor: [0, -28]
      });
        

      function onEachFeature(feature, layer) {
        var popupContent = "<p>I started out as a GeoJSON " +
            feature.geometry.type + ", but now I'm a Leaflet vector!</p>";

        if (feature.properties && feature.properties.popupContent) {
          popupContent += feature.properties.popupContent;
        }

        layer.bindPopup(popupContent);
      }
      window.assetLayerGroup = L.layerGroup().addTo(map);

      var coorsLayer = L.geoJson(refugi, {

        pointToLayer: function (feature, latlng) {
          return L.marker(latlng, {icon: expIcon});
        },

        onEachFeature: onEachFeature
      });//.addTo(assetLayerGroup);
      var refugiLay = L.layerGroup();
      var refuguis = L.geoJson(refugi, {

        style: function (feature) {
          return feature.properties && feature.properties.style;
        },

        onEachFeature: onEachFeature,

        pointToLayer: function (feature, latlng) {
          return L.circleMarker(latlng, {
            radius: 5,
            fillColor: "#ff7800",
            color: "#000",
            weight: 1,
            opacity: 1,
            fillOpacity: 0.8
          });
        }
      }).addTo(refugiLay);

      var overlayMaps = {
        "Refuguis": refugiLay
      };
      L.control.layers(baseMaps, overlayMaps).addTo(map);
      /*
      L.geoJson(refugi, {

        style: function (feature) {
          return feature.properties && feature.properties.style;
        },

        onEachFeature: onEachFeature,

        pointToLayer: function (feature, latlng) {
          return L.circleMarker(latlng, {
            radius: 5,
            fillColor: "#ff7800",
            color: "#000",
            weight: 1,
            opacity: 1,
            fillOpacity: 0.8
          });
        }
      }).addTo(map);*/

    
     


	});

      //window.sumatotal = 0;
      function imprimir(diaBomb, lat, lon, zoom){
        assetLayerGroup.clearLayers();
        map.setView([lat,lon], zoom);
        setTimeout(function() {

  //your code to be executed after 1 second

          //document.getElementById("datas").innerHTML = "30/1/1938";
          //document.getElementById("morts").innerHTML = "100 victimes";
          
          function onEachFeature(feature, layer) {
            var popupContent = "<p>I started out as a GeoJSON " +
                feature.geometry.type + ", but now I'm a Leaflet vector!</p>";

            if (feature.properties && feature.properties.popupContent) {
              popupContent += feature.properties.popupContent;
            }

            layer.bindPopup(popupContent);
          }
          var coorsLayer = L.geoJson(diaBomb, {

            pointToLayer: function (feature, latlng) {
              var markerBombs= L.marker(latlng, {
                icon: bombIcon,
                bounceOnAdd: true,
                bounceOnAddOptions: {duration: 1500, height: 400}
                

              });
              return markerBombs;
            },

            onEachFeature: onEachFeature
          }).addTo(assetLayerGroup);
          
          setTimeout(function() {
            coorsLayer
            assetLayerGroup.clearLayers();
            var coorsLayerExp = L.geoJson(diaBomb, {

            pointToLayer: function (feature, latlng) {
              var markerBombs= L.marker(latlng, {
                icon: expIcon
                

              });
              return markerBombs;
            },

            onEachFeature: onEachFeature
          }).addTo(assetLayerGroup);
            assetLayerGroup.removeLayer(coorsLayer);
          }, 1000);
          /*$('#numMorts').animateNumber(
            {
              number: diaBomb.morts,
            }
          );*/
          //sumatotal= sumatotal + diaBomb.morts;
        }, 1000);

      }
      
      function simplificat(popTime, startTime, endTime, diaBomb, lat, lon, zoom){
        popTime.code({
            start: startTime,
            end: endTime,
            onStart: function() {
              imprimir(diaBomb, lat,lon, zoom);
            }
          });

      }

      // ensure the web page (DOM) has loaded
      document.addEventListener("DOMContentLoaded", function () {
           // Create a popcorn instance by calling the Youtube player plugin
        var videoPop = Popcorn( "#ourvideo" );
       
        simplificat(videoPop, 4.8, 5.7, dia1, 41.383380, 2.175644, 16);
        /*simplificat(videoPop,9.8, 10.7, dia19380130, 41.385614, 2.168241, 15);
        simplificat(videoPop,14.8, 15.7, dia19380125, 41.385614, 2.168241, 15);
        simplificat(videoPop,19.8, 20.7, dia19380101, 41.385614, 2.168241, 15);
        simplificat(videoPop,24.8, 25.7, dia19380317, 41.385614, 2.168241, 15);
        simplificat(videoPop,29.8, 30.7, dia19381021, 41.385614, 2.168241, 15);
        simplificat(videoPop,34.8, 35.7, dia19380819, 41.385614, 2.168241, 15);
        simplificat(videoPop,39.8, 40.7, dia19380305, 41.385614, 2.168241, 15);
        simplificat(videoPop,44.8, 45.7, dia19381004, 41.385614, 2.168241, 15);
        simplificat(videoPop,49.8, 50.7, dia19390124, 41.383380, 2.175644, 16);
        simplificat(videoPop,54.8, 55.7, dia19371001, 41.383380, 2.175644, 16);
        simplificat(videoPop,59.8, 60.7, dia19390121, 41.383380, 2.175644, 16);
        */
      }, false);

    </script>

</head>
<body>
  <div style="position: relative;" id="map"></div>
  <div style="position: absolute; right: 30px; bottom: 50px; " id="capa" > 

      <font size="15" id="morts" style="color: #000000; background-color: #ffffff" align = "left">Morts: <span id="numMorts" >0 </span></font>
      <br>
      <font size="17" id="morts" style="color: #000000; background-color: #ffffff" align = "left">Total: <span id="numTotal" style="color: red;"></span> </font>
      <br>
      <font size="17 " id="datas" style="color: #000000; background-color: #ffffff"; align = "left" >Bombardejos BCN</font>
      <br>
      <video height="270" width="450" id="ourvideo" controls>
        <source src="bombesTmp.mp4" type="video/mp4">
        
      </video>
  </div>
  

</body>
    
</html>

